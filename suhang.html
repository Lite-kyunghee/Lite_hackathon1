<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>L.I.T.E | ìˆ˜í–‰í‰ê°€ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
  <style>
    :root {
      color-scheme: dark;
      --bg: #0b132b;
      --panel: #0f172a;
      --panel-2: #0b1020;
      --line: rgba(148, 163, 253, 0.18);
      --line-2: rgba(75, 85, 99, 0.35);
      --ink: #fff;
      --sub: #9ca3af;
      --brand: #4f46e5;
      --brand-2: #38bdf8;
      --warn: #fb7185;
      --ok: #22c55e;
      --muted: #6b7280;
      --gold: #facc15;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Noto Sans KR', system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--ink);
    }
    header {
      position: sticky;
      top: 0;
      backdrop-filter: blur(6px);
      background: rgba(11, 19, 43, 0.8);
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.9rem 1rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.12);
      z-index: 20;
    }
    header .title {
      font-weight: 700;
      letter-spacing: 0.3px;
      font-size: 1.1rem;
    }
    main {
      max-width: 1100px;
      margin: 1.4rem auto 2.4rem;
      padding: 0 1rem;
    }
    .toolbar {
      display: grid;
      grid-template-columns: 1fr repeat(4, max-content);
      gap: 0.5rem;
      align-items: center;
      margin-bottom: 1rem;
    }
    @media (max-width: 860px) {
      .toolbar {
        grid-template-columns: 1fr 1fr 1fr;
      }
    }
    @media (max-width: 540px) {
      .toolbar {
        grid-template-columns: 1fr 1fr;
      }
    }
    input[type="search"], select {
      padding: 0.6rem 0.9rem;
      border-radius: 8px;
      border: none;
      background: rgba(148, 163, 253, 0.1);
      color: #e5e7eb;
      outline: none;
      min-width: 140px;
    }
    input::placeholder { color: rgba(148, 163, 253, 0.7); }
    .btn {
      padding: 0.55rem 0.9rem;
      border-radius: 8px;
      border: 1px solid rgba(129, 140, 248, 0.5);
      background: rgba(15, 23, 42, 0.9);
      color: #e5e7eb;
      cursor: pointer;
      font-size: 0.9rem;
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      white-space: nowrap;
    }
    .btn:hover {
      background: rgba(79, 70, 229, 0.9);
      box-shadow: 0 0 12px rgba(79, 70, 229, 0.5);
    }
    .btn.toggle-on {
      background: rgba(79, 70, 229, 0.9);
      border-color: rgba(79, 70, 229, 0.9);
    }
    .card {
      background: var(--panel);
      border-radius: 14px;
      border: 1px solid var(--line);
      overflow: hidden;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.9);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.92rem;
    }
    thead th {
      text-align: left;
      padding: 0.75rem 1rem;
      background: radial-gradient(circle at top left, rgba(79, 70, 229, 0.22), transparent);
      border-bottom: 1px solid rgba(148, 163, 253, 0.25);
      font-weight: 700;
      color: #c7d2fe;
      white-space: nowrap;
    }
    tbody td {
      padding: 0.72rem 1rem;
      border-top: 1px solid var(--line-2);
      vertical-align: middle;
      background: var(--panel-2);
    }
    tbody tr:nth-child(even) td { background: var(--panel); }
    .badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.13rem 0.5rem;
      margin-left: 0.35rem;
      border-radius: 999px;
      font-size: 0.7rem;
      border: 1px solid rgba(129, 140, 248, 0.8);
      color: #a5b4fc;
      background: rgba(17, 24, 39, 0.96);
    }
    .grade { color: var(--brand-2); font-weight: 600; }
    .favorite-btn {
      background: none;
      border: none;
      font-size: 1.25rem;
      cursor: pointer;
      color: rgba(148, 163, 253, 0.4);
      padding: 0;
    }
    .favorite-btn.active { color: var(--gold); text-shadow: 0 0 8px rgba(250, 204, 21, 0.7); }
    .dday { font-weight: 700; color: var(--brand-2); }
    .dday.expired { color: var(--warn); }
    .dday.today { color: var(--ok); }
    .dday.none { color: var(--muted); font-weight: 500; }
    .empty { text-align: center; padding: 1rem; color: #9ca3af; }

    /* í•˜ì´ë¼ì´íŠ¸ ì• ë‹ˆë©”ì´ì…˜ */
    .focus-hit {
      position: relative;
      outline: 2px solid #60a5fa;
      animation: blink 1.2s ease-in-out 0s 2 alternate;
      scroll-margin-top: 84px;
    }
    @keyframes blink {
      from { box-shadow: 0 0 0px rgba(96,165,250,0.0); }
      to   { box-shadow: 0 0 24px rgba(96,165,250,0.7); }
    }

    @media (max-width: 720px) {
      thead th:nth-child(2),
      tbody td:nth-child(2) { display: none; } /* êµì‚¬ ì»¬ëŸ¼ ëª¨ë°”ì¼ ì¶•ì†Œ */
    }
  </style>
</head>
<body>
  <header>
    <button class="btn" id="backBtn">â† ë’¤ë¡œ</button>

    
    <div class="title">ğŸ“ ìˆ˜í–‰í‰ê°€ ê´€ë¦¬ ì‹œìŠ¤í…œ</div>
  </header>

  <main>
    <div class="toolbar">
      <input id="searchInput" type="search" placeholder="ì œëª©/êµì‚¬/í•™ë…„/ê³¼ëª© ê²€ìƒ‰â€¦" />
      <select id="gradeFilter" title="í•™ë…„ í•„í„°">
        <option value="">ì „ì²´ í•™ë…„</option>
        <option value="1í•™ë…„">1í•™ë…„</option>
        <option value="2í•™ë…„">2í•™ë…„</option>
        <option value="3í•™ë…„">3í•™ë…„</option>
        <option value="ì „í•™ë…„">ì „í•™ë…„</option>
      </select>
      <select id="subjectFilter" title="ê³¼ëª© í•„í„°">
        <option value="">ì „ì²´ ê³¼ëª©</option>
        <option value="êµ­ì–´">êµ­ì–´</option>
        <option value="ì˜ì–´">ì˜ì–´</option>
        <option value="ìˆ˜í•™">ìˆ˜í•™</option>
        <option value="ê³¼í•™">ê³¼í•™</option>
        <option value="ê¸°íƒ€">ê¸°íƒ€</option>
      </select>
      <button class="btn" id="nearBtn" title="ì„ë°•ë§Œ(3ì¼ ì´ë‚´) í† ê¸€">â° ì„ë°•ë§Œ</button>
      <button class="btn" id="sortBtn" title="ë§ˆê°ì¼ìˆœ ì •ë ¬ í† ê¸€">ğŸ“… ë§ˆê°ì¼ìˆœ</button>
      <button class="btn" id="favBtn" title="ì¦ê²¨ì°¾ê¸°ë§Œ í† ê¸€">â­ ì¦ê²¨ì°¾ê¸°ë§Œ</button>
    </div>

    <section class="card">
      <table>
        <thead>
          <tr>
            <th>ìˆ˜í–‰í‰ê°€</th>
            <th>ë‹´ë‹¹ êµì‚¬</th>
            <th>í•™ë…„</th>
            <th>ë§ˆê°ì¼</th>
            <th>D-Day</th>
            <th>â­</th>
          </tr>
        </thead>
        <tbody id="tbody">
          <tr><td colspan="6" class="empty">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</td></tr>
        </tbody>
      </table>
    </section>
  </main>

  <script>

    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 0) ë¡œë“œ: suhang.json(ë™ì¼ í´ë”) â†’ í´ë°± ìƒ˜í”Œ
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const FALLBACK_SAMPLES = [
      { title: '2025ë…„ 2í•™ë…„ ê³¼í•™ - ë¬¼ë¦¬í•™ ì¶”ê°€íƒêµ¬ ë³´ê³ ì„œ ì œì¶œ', teacher: 'ìœ í˜œì›',           grade: '2í•™ë…„', subject: 'ê³¼í•™', due: '2025-10-10' },
      { title: '2025ë…„ 2í•™ë…„ ê³¼í•™ - [í™”í•™â… ] í™”í•™íƒêµ¬ë³´ê³ ì„œ ì œì¶œ',       teacher: 'í™©ìœ¤ì„œ, ì¥ë‹¤ì •', grade: '2í•™ë…„', subject: 'ê³¼í•™', due: '2025-10-12' },
      { title: '2025ë…„ 2í•™ë…„ ìˆ˜í•™ - ê¸°í•˜ 2í•™ê¸° ë°œí‘œ ìˆ˜í–‰í‰ê°€ ì•ˆë‚´',       teacher: 'ë°°ì¤€',             grade: '2í•™ë…„', subject: 'ìˆ˜í•™', due: '2025-10-18' },
      { title: '2025ë…„ 2í•™ë…„ ê³¼í•™ - ì§€êµ¬ê³¼í•™â…  ê³¼í•™íƒêµ¬ë³´ê³ ì„œ(ìˆ˜í–‰í‰ê°€)', teacher: 'ê¹€ê¸°ê¶Œ',           grade: '2í•™ë…„', subject: 'ê³¼í•™', due: '2025-10-20' },
      { title: '2025ë…„ 2í•™ë…„ ì˜ì–´ - Speaking ìˆ˜í–‰í‰ê°€ ê³µì§€',            teacher: 'ì˜¤ê°€ì˜',           grade: '2í•™ë…„', subject: 'ì˜ì–´', due: '2025-10-22' },
      { title: '2025ë…„ 2í•™ë…„ ìˆ˜í•™ - í™•ë¥ ê³¼í†µê³„ ì‹¬í™”íƒêµ¬ ë³´ê³ ì„œ(ê¸°í•œ ë‚´ ë¯¸ì œì¶œì)', teacher: 'ê°•ìˆ˜ë¯¸', grade: '2í•™ë…„', subject: 'ìˆ˜í•™', due: '2025-10-25' },
      { title: '2025ë…„ 2í•™ê¸° ë¬¼ë¦¬í•™ ìˆ˜í–‰í‰ê°€(íƒêµ¬ ë³´ê³ ì„œ)',              teacher: 'ìœ í˜œì›',           grade: '2í•™ë…„', subject: 'ê³¼í•™', due: '2025-11-01' },
      { title: '2025ë…„ 2í•™ê¸° ìˆ˜í•™â…  ì„œë…¼ìˆ í˜• ìˆ˜í–‰í‰ê°€ ë¬¸ì œ ì˜ˆì‹œ ë¬¸í•­ ì•ˆë‚´', teacher: 'ë°°ì¤€',           grade: '2í•™ë…„', subject: 'ìˆ˜í•™', due: '2025-11-03' },
      { title: '2025ë…„ 2í•™ë…„ ê³¼í•™ - 2í•™ë…„ ìƒëª…ê³¼í•™â…  íƒêµ¬ë³´ê³ ì„œ ì™„ì„± ì œì¶œ', teacher: 'ë°•í˜„ë¬˜',         grade: '2í•™ë…„', subject: 'ê³¼í•™', due: '2025-11-07' },
      { title: '2025ë…„ 2í•™ë…„ êµ­ì–´ - [2-7] 2í•™ê¸° ë¬¸í•™ ìˆ˜í–‰í‰ê°€(í™œë™ì§€)',   teacher: 'ìœ ì •í™”, ê°•ë¯¼ì² ',   grade: '2í•™ë…„', subject: 'êµ­ì–´', due: '2025-11-10' },
      { title: '2025ë…„ 2í•™ë…„ ì˜ì–´ - 2í•™ë…„ ì˜ì–´ ê³¼ì„¸íŠ¹ ê¸°ì´ˆìë£Œ ì œì¶œ',    teacher: 'ì˜¤ê°€ì˜',           grade: '2í•™ë…„', subject: 'ì˜ì–´', due: '2025-11-05' },
      { title: '2025ë…„ 2í•™ë…„ ê¸°íƒ€ - ë¬¸ì œ ë³€í™”ì˜ ëª¨ë¹Œ(2-7)',              teacher: 'ê¹€í˜œìˆ˜',           grade: '2í•™ë…„', subject: 'ê¸°íƒ€', due: '2025-11-15' },
      { title: '2025ë…„ 2í•™ë…„ ê¸°íƒ€ - ë¬¸ì œë¶„ì„(2-7)',                      teacher: 'ê¹€í˜œìˆ˜',           grade: '2í•™ë…„', subject: 'ê¸°íƒ€', due: '2025-11-18' },
      { title: '2025ë…„ 2í•™ë…„ êµ­ì–´ - 2í•™ê¸° ìˆ˜í–‰í‰ê°€ ì°¸ê³  ì†Œì„¤ íŒŒì¼1(ë‹¤ì„¯ í¸ ëª¨ìŒ)', teacher: 'ìœ ì •í™”', grade: '2í•™ë…„', subject: 'êµ­ì–´', due: '2025-10-05' },
      { title: '2025ë…„ 2í•™ë…„ ìˆ˜í•™ - ìˆ˜í•™â…¡ ì‹¬í™”íƒêµ¬ ë³´ê³ ì„œ(7ë°˜)',         teacher: 'ì •ì£¼í¬',           grade: '2í•™ë…„', subject: 'ìˆ˜í•™', due: '2025-11-20' },
      { title: '2025ë…„ 2í•™ë…„ ìˆ˜í•™ - ìˆ˜ì—…ìœ ì—°í™” - ë‚˜ëŠ” ì™œ ìˆ˜í•™ì„ ëª»í•˜ëŠ”ê°€',  teacher: 'ì •ì£¼í¬',         grade: '2í•™ë…„', subject: 'ìˆ˜í•™', due: '2025-06-10' },
      { title: '2025ë…„ 2í•™ë…„ ê³¼í•™ - 2í•™ë…„ ì§€êµ¬ê³¼í•™â…  ê³¼í•™ë…ì„œë³´ê³ ì„œ(ì„¸íŠ¹ì¶”ê°€íƒêµ¬)', teacher: 'ê¹€ê¸°ê¶Œ', grade: '2í•™ë…„', subject: 'ê³¼í•™', due: '2025-06-15' },

      // ì „í•™ë…„/ê¸°íƒ€ â€” due: null (ì•Œë¦¼/ì„ë°• ì œì™¸)
      { title: '2025ë…„ ì „í•™ë…„ ê¸°íƒ€ - 2í•™ê¸° ê±´ê°•ì¤‘ì§„êµìœ¡ë´‰ì‚¬ í¬ìŠ¤í„°, í™œë™ì¼ì§€ ì œì¶œ', teacher: 'ì§€ë¯¼í¬', grade: 'ì „í•™ë…„', subject: 'ê¸°íƒ€', due: null },
      { title: '2025ë…„ ì „í•™ë…„ ê¸°íƒ€ - 2025-2 ë³´ê±´ ìˆ˜ì—… ì‹¬í™” íƒêµ¬',                        teacher: 'ì§€ë¯¼í¬', grade: 'ì „í•™ë…„', subject: 'ê¸°íƒ€', due: null },
      { title: '2025ë…„ ì „í•™ë…„ ê¸°íƒ€ - ê±´ê°•ì¦ì§„ êµìœ¡ë´‰ì‚¬ í™œë™ì¼ì§€ ì œì¶œ',                    teacher: 'ì§€ë¯¼í¬', grade: 'ì „í•™ë…„', subject: 'ê¸°íƒ€', due: null },
      { title: '2025ë…„ ì „í•™ë…„ ê¸°íƒ€ - í†µë²ˆì—­ ë™ì•„ë¦¬ ì‚°ì¶œë¬¼ ì œì¶œ',                            teacher: 'í™©ì°½ìˆ˜', grade: 'ì „í•™ë…„', subject: 'ê¸°íƒ€', due: null },
      { title: '2025ë…„ ì „í•™ë…„ ê¸°íƒ€ - [ìˆ˜ì—…í™œìš© ìœ ì—°í™”](Web Hacking) ì‹¤ìŠµ ë³´ê³ ì„œ ì œì¶œ',     teacher: 'ìœ¤ì‹œë‚´', grade: 'ì „í•™ë…„', subject: 'ê¸°íƒ€', due: null },
      { title: '2025ë…„ ì „í•™ë…„ ê³¼í•™ - ìƒì²´ì‹ í˜¸ì™€ ë””ì§€í„¸í—¬ìŠ¤ 3,4ì¼ì°¨ ë³´ê³ ì„œ ì œì¶œ',           teacher: 'ì§€ë¯¼í¬', grade: 'ì „í•™ë…„', subject: 'ê³¼í•™', due: null },
      { title: '2025ë…„ ì „í•™ë…„ ê³¼í•™ - [ìˆ˜ì—…í™œìš© ìœ ì—°í™”] ë‚˜ë§Œì˜ ì£¼ê¸°ìœ¨í‘œ ë§Œë“¤ê¸°',             teacher: 'í™©ìœ¤ì„œ', grade: 'ì „í•™ë…„', subject: 'ê³¼í•™', due: null },
      { title: '2025ë…„ ì „í•™ë…„ ê¸°íƒ€ - í•´í‚¹ë°˜ 1í•™ê¸° ë™ì•„ë¦¬ í™œë™ ë³´ê³ ì„œ',                      teacher: 'ìœ¤ì‹œë‚´', grade: 'ì „í•™ë…„', subject: 'ê¸°íƒ€', due: null },
      { title: '2025ë…„ ì „í•™ë…„ ê¸°íƒ€ - [ìˆ˜ì—…í™œìš© ìœ ì—°í™”](Web Hacking) ììœ¨ì  êµìœ¡ê³¼ì • íƒêµ¬ ë³´ê³ ì„œ ì œì¶œ', teacher: 'ìœ¤ì‹œë‚´', grade: 'ì „í•™ë…„', subject: 'ê¸°íƒ€', due: null },
      { title: '2025ë…„ ì „í•™ë…„ ê¸°íƒ€ - ì°½ì˜ë¡œë´‡ë°˜ í™œë™ì¼ì§€',                                    teacher: 'í™©ë¯¼ê¸°', grade: 'ì „í•™ë…„', subject: 'ê¸°íƒ€', due: null },
      { title: '2025ë…„ ì „í•™ë…„ ê¸°íƒ€ - ê³µê°„ ì‹¬í™” íƒêµ¬ ì£¼ì œ ë³´ê³ ì„œ ì œì¶œ',                        teacher: 'í™©ìŠ¹ê·¼', grade: 'ì „í•™ë…„', subject: 'ê¸°íƒ€', due: null },
      { title: '2025ë…„ ì „í•™ë…„ ê³¼í•™ - [ìˆ˜ì—…í™œìš©ìœ ì—°í™”] í¬ì¸íŒ… ë²¡í„°, ê³µê°„ì„ ì§€ë‚˜ëŠ” ì—ë„ˆì§€ íë¦„', teacher: 'í™©ë¯¼ê¸°', grade: 'ì „í•™ë…„', subject: 'ê³¼í•™', due: null },
      { title: '2025ë…„ ì „í•™ë…„ ê³¼í•™ - ê¸°í›„ ë³€í™”ì— ëŒ€í•œ ê³¼í•™ì  í•´ê²° ë°©ë²• ì—°êµ¬(ìˆ˜ì—…ìœ ì—°í™”Â·ììœ¨ì  êµìœ¡ê³¼ì •)', teacher: 'ê¹€ê¸°ê¶Œ', grade: 'ì „í•™ë…„', subject: 'ê³¼í•™', due: null },
    ];

    let SUHANG = []; // ìµœì¢… ë°ì´í„°

     (function setupBack(){
    const FALLBACK_HOME = "lite_hackathon.html"; // í•„ìš”í•˜ë©´ ê²½ë¡œ ìˆ˜ì •

    const backBtn = document.getElementById("backBtn");
    backBtn.addEventListener("click", function (e) {
      e.preventDefault();

      const hasHistory = window.history.length > 1;
      const ref = document.referrer;
      let sameOrigin = false;

      try {
        sameOrigin = ref && new URL(ref).origin === location.origin;
      } catch {}

      // ë’¤ë¡œê°€ê¸° ê°€ëŠ¥í•œ ì•ˆì „í•œ ì¡°ê±´
      if (hasHistory && sameOrigin) {
        history.back();

        // ì¼ë¶€ ë¸Œë¼ìš°ì €ì—ì„œ back()ì´ ë¬´ì‹œë  ë•Œ í´ë°±
        setTimeout(() => {
          if (document.visibilityState === "visible") {
            location.href = FALLBACK_HOME;
          }
        }, 500);
      } else {
        // íˆìŠ¤í† ë¦¬ ì—†ìŒ â†’ í™ˆìœ¼ë¡œ ë°”ë¡œ ì´ë™
        location.href = FALLBACK_HOME;
      }
    });
  })();

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 1) ìƒíƒœ
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let favorites = JSON.parse(localStorage.getItem('suhangFavorites') || '[]');
    let showFavOnly = false;
    let sortByDue = false;
    let nearOnly = false; // ì„ë°•(â‰¤3ì¼)ë§Œ

    const $tbody   = document.getElementById('tbody');
    const $search  = document.getElementById('searchInput');
    const $grade   = document.getElementById('gradeFilter');
    const $subject = document.getElementById('subjectFilter');
    const $sortBtn = document.getElementById('sortBtn');
    const $favBtn  = document.getElementById('favBtn');
    const $nearBtn = document.getElementById('nearBtn');

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 2) ìœ í‹¸
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function normalizeStr(s) {
      return (s || "").toString().trim().toLowerCase();
    }
    function calcDDay(due) {
      if (!due) return { label: '-', cls: 'dday none', days: Infinity };
      const today = new Date(); today.setHours(0,0,0,0);
      const d = new Date(due); d.setHours(0,0,0,0);
      const diff = Math.floor((d - today) / (1000*60*60*24));
      if (diff < 0)  return { label: 'ë§ˆê°', cls: 'dday expired', days: diff };
      if (diff === 0) return { label: 'D-Day', cls: 'dday today', days: 0 };
      return { label: `D-${diff}`, cls: 'dday', days: diff };
    }
    function shouldAlert(entry) {
      if (!entry?.due) return false;
      if (entry.grade === 'ì „í•™ë…„' && entry.subject === 'ê¸°íƒ€') return false;
      const d = calcDDay(entry.due);
      return d.days === 1; // D-1
    }
    function slugifyTitle(t) {
      return encodeURIComponent((t || '').toString().trim().toLowerCase());
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 3) ë Œë”
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function render(focus) {
      let list = [...SUHANG];

      // ê²€ìƒ‰ì–´ (ì œëª©/êµì‚¬/í•™ë…„/ê³¼ëª©)
      const kw = normalizeStr($search.value);
      if (kw) {
        list = list.filter(x => {
          const blob = [x.title, x.teacher, x.grade, x.subject].map(normalizeStr).join(' ');
          return blob.includes(kw);
        });
      }
      // í•™ë…„/ê³¼ëª© í•„í„°
      if ($grade.value)   list = list.filter(x => x.grade   === $grade.value);
      if ($subject.value) list = list.filter(x => x.subject === $subject.value);

      // ì¦ê²¨ì°¾ê¸°ë§Œ
      if (showFavOnly) list = list.filter(x => favorites.includes(x.title));

      // ì„ë°•ë§Œ(â‰¤3ì¼) â€” due ì—†ëŠ” ì „í•™ë…„ ê¸°íƒ€ ì œì™¸
      if (nearOnly) {
        list = list.filter(x => {
          if (!x.due) return false;
          if (x.grade === 'ì „í•™ë…„' && x.subject === 'ê¸°íƒ€') return false;
          return calcDDay(x.due).days >= 0 && calcDDay(x.due).days <= 3;
        });
      }

      // ì •ë ¬: ë§ˆê°ì¼ ì˜¤ë¦„ì°¨ìˆœ (nullì€ ë’¤ë¡œ)
      if (sortByDue) {
        list.sort((a, b) => {
          if (!a.due && !b.due) return 0;
          if (!a.due) return 1;
          if (!b.due) return -1;
          return new Date(a.due) - new Date(b.due);
        });
      }

      if (!list.length) {
        $tbody.innerHTML = `<tr><td colspan="6" class="empty">ì¡°ê±´ì— ë§ëŠ” ìˆ˜í–‰í‰ê°€ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
        return;
      }

      $tbody.innerHTML = list.map(x => {
        const dday = calcDDay(x.due);
        const favActive = favorites.includes(x.title);
        const rowId = "row-" + slugifyTitle(x.title);
        return `
          <tr id="${rowId}">
            <td>${x.title}<span class="badge">${x.subject}</span></td>
            <td>${x.teacher}</td>
            <td><span class="grade">${x.grade}</span></td>
            <td>${x.due || '-'}</td>
            <td><span class="${dday.cls}">${dday.label}</span></td>
            <td>
              <button class="favorite-btn ${favActive ? 'active' : ''}" onclick="toggleFavorite('${x.title.replace(/'/g, "\\'")}')">â˜…</button>
            </td>
          </tr>
        `;
      }).join('');

      if (focus) {
        requestAnimationFrame(() => focusRow(focus));
      }
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 4) í•˜ì´ë¼ì´íŠ¸ / í¬ì»¤ìŠ¤
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function focusRowByTitle(titleExact) {
      if (!titleExact) return false;
      const rowId = "row-" + slugifyTitle(titleExact);
      return focusRow(rowId);
    }
    function focusRowByQuery(q) {
      const kw = normalizeStr(q);
      if (!kw) return false;
      // ëª©ë¡ì—ì„œ ì²« ë§¤ì¹˜ ì°¾ê¸°
      const hit = SUHANG.find(x => {
        const blob = [x.title, x.teacher, x.grade, x.subject].map(normalizeStr).join(' ');
        return blob.includes(kw);
      });
      if (!hit) return false;
      const rowId = "row-" + slugifyTitle(hit.title);
      return focusRow(rowId);
    }
    function focusRow(rowIdOrElementId) {
      const el = document.getElementById(rowIdOrElementId) ||
                 document.querySelector(`[id="${CSS.escape(rowIdOrElementId)}"]`);
      if (!el) return false;
      el.classList.remove('focus-hit');
      // ê°•ì œë¡œ ë¦¬í”Œë¡œìš° í›„ ì• ë‹ˆë©”ì´ì…˜ ì¬ì ìš©
      void el.offsetWidth;
      el.classList.add('focus-hit');
      el.scrollIntoView({ behavior: 'smooth', block: 'center' });
      return true;
    }

    // ì „ì—­ ë…¸ì¶œ (AI/ë‹¤ë¥¸ íƒ­ì—ì„œ í˜¸ì¶œìš©)
    window.focusSuhangByTitle = (t) => { render(); setTimeout(() => focusRowByTitle(t), 50); };
    window.focusSuhangByQuery = (q)   => { render(); setTimeout(() => focusRowByQuery(q), 50); };

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 5) ì¦ê²¨ì°¾ê¸°/í† ê¸€/ì•Œë¦¼
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function toggleFavorite(title) {
      const idx = favorites.indexOf(title);
      if (idx >= 0) favorites.splice(idx, 1);
      else favorites.push(title);
      localStorage.setItem('suhangFavorites', JSON.stringify(favorites));
      render();
    }
    window.toggleFavorite = toggleFavorite;

    // D-1 ì•Œë¦¼ (ì„¸ì…˜ ë‹¹ 1íšŒ)
    function checkAlertsOnce() {
      const alerted = sessionStorage.getItem('suhangAlerted');
      if (alerted) return;
      const near = SUHANG.filter(shouldAlert);
      if (near.length) {
        alert('ğŸ“¢ ë§ˆê° í•˜ë£¨ ì „ ìˆ˜í–‰í‰ê°€:\n\n' + near.map(x => 'â€¢ ' + x.title).join('\n'));
      }
      sessionStorage.setItem('suhangAlerted', '1');
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 6) ì´ë²¤íŠ¸
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function bindEvents() {
      $search.addEventListener('input', () => render());
      $grade.addEventListener('change', () => render());
      $subject.addEventListener('change', () => render());

      $sortBtn.addEventListener('click', () => {
        sortByDue = !sortByDue;
        $sortBtn.classList.toggle('toggle-on', sortByDue);
        $sortBtn.textContent = sortByDue ? 'ğŸ“… ë§ˆê°ì¼ìˆœ(ON)' : 'ğŸ“… ë§ˆê°ì¼ìˆœ';
        render();
      });

      $favBtn.addEventListener('click', () => {
        showFavOnly = !showFavOnly;
        $favBtn.classList.toggle('toggle-on', showFavOnly);
        $favBtn.textContent = showFavOnly ? 'â­ ì¦ê²¨ì°¾ê¸°ë§Œ(ON)' : 'â­ ì¦ê²¨ì°¾ê¸°ë§Œ';
        render();
      });

      $nearBtn.addEventListener('click', () => {
        nearOnly = !nearOnly;
        $nearBtn.classList.toggle('toggle-on', nearOnly);
        $nearBtn.textContent = nearOnly ? 'â° ì„ë°•ë§Œ(ON)' : 'â° ì„ë°•ë§Œ';
        render();
      });
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 7) í¬ì»¤ìŠ¤ íŒŒë¼ë¯¸í„°/ì„¸ì…˜ ì²˜ë¦¬
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function handleFocusIntent() {
      const params = new URLSearchParams(location.search);
      const pTitle = params.get('title'); // ì •í™• ì œëª©
      const pFocus = params.get('focus'); // í¬í•¨ ê²€ìƒ‰

      const fromSession = sessionStorage.getItem('suhangFocus');
      let sessionObj = null;
      if (fromSession) {
        try { sessionObj = JSON.parse(fromSession); } catch(e) {}
        sessionStorage.removeItem('suhangFocus');
      }

      if (pTitle) {
        setTimeout(() => focusRowByTitle(pTitle), 60);
      } else if (pFocus) {
        setTimeout(() => focusRowByQuery(pFocus), 60);
      } else if (sessionObj?.title) {
        setTimeout(() => focusRowByTitle(sessionObj.title), 60);
      } else if (sessionObj?.query) {
        setTimeout(() => focusRowByQuery(sessionObj.query), 60);
      }
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 8) ì´ˆê¸°í™”: ë°ì´í„° ë¡œë“œ â†’ ë Œë”/ì´ë²¤íŠ¸/ì•Œë¦¼/í¬ì»¤ìŠ¤
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function loadData() {
      try {
        const res = await fetch('suhang.json', { cache: 'no-store' });
        if (!res.ok) throw new Error('no json');
        const arr = await res.json();
        if (Array.isArray(arr) && arr.length) {
          SUHANG = arr.map(x => ({
            title:   x.title   ?? '',
            teacher: x.teacher ?? '',
            grade:   x.grade   ?? '',
            subject: x.subject ?? '',
            due:     x.due     ?? null,
          }));
          return;
        }
        throw new Error('empty');
      } catch (e) {
        // í´ë°±
        SUHANG = FALLBACK_SAMPLES;
      }
    }

    (async function init() {
      await loadData();
      bindEvents();
      render();
      checkAlertsOnce();
      handleFocusIntent();
    })();
  </script>
</body>
</html>
